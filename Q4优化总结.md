# Q4Solver 优化总结

## 问题分析
- **原始问题**: Q4Solver_origin.py 可以得到合理但不够优秀的结果
- **Visual版问题**: Q4Solver_visual.py 存在语法错误和逻辑问题，无法正常运行

## 主要优化措施

### 1. 固定FY1参数
- 使用第二问的最优解作为FY1的固定参数：
  ```python
  FY1_FIXED = {
      "speed": 112.0298,
      "heading": 0.137353,
      "drop_time": 0.0045,
      "fuse_delay": 0.4950
  }
  ```
- 专注于优化FY2和FY3，减少搜索空间

### 2. 改进候选生成算法
- **更精细的搜索网格**: s参数从14个点增加到20个点，范围从[0.05,1.0]扩展到[0.3,0.95]
- **更多横向偏移选项**: 增加±0.025的偏移量
- **放宽速度容差**: 从严格匹配放宽到5%容差
- **协同潜力评估**: 增加协同潜力指标，优先保留有利于协同的候选

### 3. 增强选择策略
- **混合选择**: 70%优先选择单体时长>0的候选，30%选择协同潜力高的候选
- **多层排序**: 按单体时长 → 协同潜力 → s值进行排序

### 4. 优化算法流程
- **简化组合搜索**: 用贪心算法替代全组合遍历，提高效率
- **固定FY1**: SA和局部优化只针对FY2和FY3，减少变量维度
- **改进评估函数**: 加入协同潜力评估

### 5. 参数调优
- **更高精度**: dt从0.004降至0.002，dt-coarse从0.012降至0.005
- **更密集采样**: nphi从360增至720，nz从4增至10
- **更多速度选项**: 从8个速度值增加到15个
- **更强SA**: 迭代次数从40增至120，温度参数调优
- **更长局部搜索**: 从默认增至60次迭代

## 文件修改

### Q4Solver_visual.py
- 基于Q4Solver_origin.py进行优化
- 修复了原visual版本的语法错误
- 集成了所有优化算法

### runQ4.bat
- 更新了所有参数以匹配优化后的算法
- 使用更高精度和更强搜索参数

## 算力优化（2024.12.19更新）

为降低计算消耗，对参数进行了平衡调整：

### runQ4.bat参数优化
- **时间步长**: dt从0.002→0.005, dt-coarse从0.005→0.015 (减少60%计算点)
- **采样密度**: nphi从720→360, nz从10→6 (减少67%采样点)
- **速度网格**: 从15个减少到8个选项 (减少47%组合)
- **Te范围**: 增大步长从0.4→0.8 (减少50%时间点)
- **候选数量**: topk从32→16, combo-topm从96→48 (减少50%候选)
- **SA参数**: 迭代从120→60, batch固定为32 (减少50%迭代)
- **局部搜索**: 从60→30次迭代 (减少50%精修)
- **横向偏移**: 从9个减少到5个选项 (减少44%搜索)

### 预期改进效果

1. **平衡精度与速度**: 适中的采样密度保证结果质量
2. **更好协同**: 专门的协同潜力评估和候选保留策略
3. **更高效率**: 固定FY1减少搜索空间，贪心算法加速组合搜索
4. **合理搜索强度**: 平衡搜索深度与计算时间
5. **更稳定**: 修复了原有的语法错误和逻辑问题

## 使用方法

直接运行优化后的批处理文件：
```bash
runQ4.bat
```

或者使用自定义参数：
```bash
python Q4Solver_visual.py --dt 0.002 --sa-iters 120 --local-iters 60
```

## 技术亮点

- **自适应搜索**: 根据候选质量动态调整搜索策略
- **协同优化**: 专门针对多无人机协同遮蔽的优化策略
- **分层优化**: 粗筛→SA→局部精修的多阶段优化
- **并行计算**: 支持多进程并行候选生成
